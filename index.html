
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Kinoの技术博客</title>
	<meta name="author" content="Kino">

	
	<meta name="description" content="May 20th, 2016 iOS Comments 在UICollectionView上实现StickyHeader效果 前几天在用UICollectionView实现组合式布局的时候，想到如果在CollectionView上要求sticky header（也就是header自动悬停置顶） &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Kinoの技术博客" type="application/atom+xml">
	
	<link rel="canonical" href="http://KinoAndWorld.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cf1125831693ae208e5e3993116c42db";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img src='http://www.gravatar.com/avatar/" + MD5("kinoandworld@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
	</script>
</div>
<h1><a href="/">Kinoの技术博客</a></h1>
<p class="subtitle">我唯一所知即是我一无所知</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/1878504510" title="Weibo">Weibo</a>
		
		
		
		
		
		<a class="github" href="https://github.com/KinoAndWorld" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<!-- <hgroup>
  <h1><a href="/">Kinoの技术博客</a></h1>
  
    <h2>我唯一所知即是我一无所知</h2>
  
</hgroup>
 -->
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-05-20T16:25:43+08:00" data-updated="true" itemprop="datePublished">May 20<span>th</span>, 2016</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2016/05/20/uicollectionview-sticky-header-implement-principle/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/05/20/uicollectionview-sticky-header-implement-principle/" itemprop="url">在UICollectionView上实现StickyHeader效果</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>前几天在用UICollectionView实现组合式布局的时候，想到如果在CollectionView上要求sticky header（也就是header自动悬停置顶）的效果应当如何实现。
我们都知道如果是在UITableView上实现非常简单，只要设置style为group然后多个section，headerView就会自动吸附在顶部。而collectionView虽然功能强大得多，但是原生并没有支持直接设置这个效果，所以需要自己实现。</p>

<p>作为一个懒人，首先想到的自然是站在巨人的肩膀上，<a href="https://github.com/jamztang/CSStickyHeaderFlowLayout">CSStickyHeaderFlowLayout</a>是一个比较知名的CollectionView布局控件，它支持sticky header效果以及头部的视差滚动效果，效果很赞。但是感觉稍微重了些，需要做更多的设置以及修改基类等。</p>

<p>然后我又找到了一篇文章，虽然已经是3年前的文章，但是写得非常简明清晰，而且阅读完有豁然开朗的感觉。</p>

<p>文章很短，全文如下：<a href="http://blog.radi.ws/post/32905838158/sticky-headers-for-uicollectionview-using">http://blog.radi.ws/post/32905838158/sticky-headers-for-uicollectionview-using</a></p>

<p>核心原理就是三句话：</p>

<ul>
<li><code>The header should be positioned so it can never go further up than one header height above the first cell in the section.</code></li>
<li><code>The header should be positioned so it can never go further down than one header header height above the lower bounds of the last cell in the section.</code></li>
<li><code>The header should be positioned so it usually stays around the top edge, referencing the content offset of the collection view.</code></li>
</ul>


<p>代码也很简单，只需要在UICollectionViewFlowLayout实现<code>layoutAttributesForElementsInRect</code>和<code>shouldInvalidateLayoutForBoundsChange</code>两个方法。</p>

<p>接着我附上文中源代码以及自己写的注释，穿插了一些对文章初略的翻译。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">layoutAttributesForElementsInRect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  返回当前显示区域的所有布局信息</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">answer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">super</span> <span class="nl">layoutAttributesForElementsInRect:</span><span class="n">rect</span><span class="p">]</span> <span class="n">mutableCopy</span><span class="p">];</span>
</span><span class='line'>    <span class="n">UICollectionView</span> <span class="o">*</span> <span class="k">const</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collectionView</span><span class="p">;</span>
</span><span class='line'>    <span class="n">CGPoint</span> <span class="k">const</span> <span class="n">contentOffset</span> <span class="o">=</span> <span class="n">cv</span><span class="p">.</span><span class="n">contentOffset</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSMutableIndexSet</span> <span class="o">*</span><span class="n">missingSections</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableIndexSet</span> <span class="n">indexSet</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  找出所有UICollectionElementCategoryCell类型的cell</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">layoutAttributes</span> <span class="k">in</span> <span class="n">answer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">representedElementCategory</span> <span class="o">==</span> <span class="n">UICollectionElementCategoryCell</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">missingSections</span> <span class="nl">addIndex:</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  再从里面删除所有UICollectionElementKindSectionHeader类型的cell</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">layoutAttributes</span> <span class="k">in</span> <span class="n">answer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">representedElementKind</span> <span class="nl">isEqualToString:</span><span class="n">UICollectionElementKindSectionHeader</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">[</span><span class="n">missingSections</span> <span class="nl">removeIndex:</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     *  默认情况下，为missingSections手动插入attributes，应该是为rect外的section生成attributes</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="p">[</span><span class="n">missingSections</span> <span class="nl">enumerateIndexesUsingBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">NSUInteger</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSIndexPath</span> <span class="nl">indexPathForItem:</span><span class="mi">0</span> <span class="nl">inSection:</span><span class="n">idx</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">layoutAttributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">layoutAttributesForSupplementaryViewOfKind:</span><span class="n">UICollectionElementKindSectionHeader</span> <span class="nl">atIndexPath:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">[</span><span class="n">answer</span> <span class="nl">addObject:</span><span class="n">layoutAttributes</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">layoutAttributes</span> <span class="k">in</span> <span class="n">answer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="cm">/**</span>
</span><span class='line'><span class="cm">         *  从answer中储存的布局信息中，针对UICollectionElementKindSectionHeader...</span>
</span><span class='line'><span class="cm">         */</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">([</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">representedElementKind</span> <span class="nl">isEqualToString:</span><span class="n">UICollectionElementKindSectionHeader</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">NSInteger</span> <span class="n">section</span> <span class="o">=</span> <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">indexPath</span><span class="p">.</span><span class="n">section</span><span class="p">;</span>
</span><span class='line'>            <span class="n">NSInteger</span> <span class="n">numberOfItemsInSection</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv</span> <span class="nl">numberOfItemsInSection:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="cm">/**</span>
</span><span class='line'><span class="cm">             *  为什么需要firstCellIndexPath和lastCellIndexPath呢？</span>
</span><span class='line'><span class="cm">             *  header应当保持着距离本section第一个cell的最大距离，简单来说就是header在置顶之前要贴着cell</span>
</span><span class='line'><span class="cm">             *  同理，header应当保持着与最后一个cell的最小距离，</span>
</span><span class='line'><span class="cm">             *  最后，在不违反上面两则约束的前提下，通过collection view的offset与header的高度来使header处于 origin.y = 0 的状态。</span>
</span><span class='line'><span class="cm">             */</span>
</span><span class='line'>            <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">firstCellIndexPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSIndexPath</span> <span class="nl">indexPathForItem:</span><span class="mi">0</span> <span class="nl">inSection:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>            <span class="n">NSIndexPath</span> <span class="o">*</span><span class="n">lastCellIndexPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSIndexPath</span> <span class="nl">indexPathForItem:</span><span class="n">MAX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">numberOfItemsInSection</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="nl">inSection:</span><span class="n">section</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="cm">/**</span>
</span><span class='line'><span class="cm">             *  针对当前layoutAttributes的section， 找出第一个和最后一个普通cell的位置</span>
</span><span class='line'><span class="cm">             */</span>
</span><span class='line'>            <span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">firstCellAttrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">layoutAttributesForItemAtIndexPath:</span><span class="n">firstCellIndexPath</span><span class="p">];</span>
</span><span class='line'>            <span class="n">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">lastCellAttrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">layoutAttributesForItemAtIndexPath:</span><span class="n">lastCellIndexPath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>            <span class="cm">/**</span>
</span><span class='line'><span class="cm">             *  获取当前处理header的高度和位置，然后通过firstCellAttrs和lastCellAttrs确定header是否置顶</span>
</span><span class='line'><span class="cm">             */</span>
</span><span class='line'>            <span class="n">CGFloat</span> <span class="n">headerHeight</span> <span class="o">=</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="n">layoutAttributes</span><span class="p">.</span><span class="n">frame</span><span class="p">);</span>
</span><span class='line'>            <span class="n">CGPoint</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">;</span>
</span><span class='line'>            <span class="n">origin</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span>
</span><span class='line'>                           <span class="n">MAX</span><span class="p">(</span>
</span><span class='line'>                               <span class="n">contentOffset</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
</span><span class='line'>                               <span class="p">(</span><span class="n">CGRectGetMinY</span><span class="p">(</span><span class="n">firstCellAttrs</span><span class="p">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">-</span> <span class="n">headerHeight</span><span class="p">)</span>
</span><span class='line'>                               <span class="p">),</span>
</span><span class='line'>                           <span class="p">(</span><span class="n">CGRectGetMaxY</span><span class="p">(</span><span class="n">lastCellAttrs</span><span class="p">.</span><span class="n">frame</span><span class="p">)</span> <span class="o">-</span> <span class="n">headerHeight</span><span class="p">)</span>
</span><span class='line'>                           <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">zIndex</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
</span><span class='line'>            <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">CGRect</span><span class="p">){</span>
</span><span class='line'>                <span class="p">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">origin</span><span class="p">,</span>
</span><span class='line'>                <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">layoutAttributes</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">answer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span> <span class="nf">shouldInvalidateLayoutForBoundsChange:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">newBound</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>感觉又涨了姿势，撒花。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-05-03T18:04:23+08:00" data-updated="true" itemprop="datePublished">May 3<span>rd</span>, 2016</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2016/05/03/build-a-reusable-common-page-in-ios/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/05/03/build-a-reusable-common-page-in-ios/" itemprop="url">Runtime实践之打造易复用的iOS公共页面</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>相信我们开发的项目中，只要涉及到网络交互，都会遇到一个再普遍的不过的需求，那就是出于用户体验的需要，在请求开始的时候显示<code>加载页</code>，请求到空数据的时候显示<code>空内容页</code>，以及请求出错的时候显示的<code>错误或重试页</code>。这三类页面在一个项目中通常是一致的（至多会有图标和文案的变化），但却要求可能在每一个涉及网络请求的页面呈现。</p>

<h2>(；′⌒`)</h2>

<p>如果没有大局观，一开始接到需求就开始在某ViewController里面添加几个View用来展现。</p>

<p>举个例子，如果要添加一个loading view，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UIView</span> <span class="o">*</span><span class="n">loadingView</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UIImageView</span> <span class="o">*</span><span class="n">loadingImageView</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后增加方法，视图的初始化和配置就省略了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *  加载视图</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startLoading</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">loadingView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingImageView</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *  停止加载并消失</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopLoading</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingImageView</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK，这样做实现上没问题，但是遇到下一个需要展示这些页面的ViewController，只能使用copy&amp;paste大法，把property和方法实现都搬到另一个ViewController，倘若有10个以上的页面，再加上万一需要修改页面的视图结构，你就会深刻的体会到
<img src="/images/heart-tried.jpg"></p>

<p>总所周知有个大原则叫做Don&rsquo;t repeat yourself。再运用上我们不为什么就很熟练的面向对象思维，自然而然可以想到，使用继承大法。</p>

<h2>╮(╯_╰)╭</h2>

<p>实现方法很简单</p>

<ul>
<li><p>首先创建一个BaseViewController，将几个property转移过来，并且展现方法也照搬，在.h文件暴露出来。</p></li>
<li><p>然后把所有用到的Controller都继承自BaseViewController，调用的地方可以保持不变，会自动调用父类的方法。</p></li>
</ul>


<p>但是这样做还是不够好，因为这需要我们把所有的Viewcontroller的头文件都改一遍，引入BaseViewController并集成，就是所谓这是带有<code>侵入性</code>的。更致命的是，如果你的ViewController本身集成了另外的BaseController，由于Objective-C不支持多继承，你只能去修改另一个BaseController……有点悲伤。</p>

<h2>╭(′▽`)╯</h2>

<p>通过标题的剧透，我们知道最后的实现跟runtime有关，那么主角也该出场了。
其实就是使用Category + runtime的对象关联。在上面的方案中，解决集成BaseViewController的侵入性的方案就是使用category为UIViewController添加方法，但是category是不能直接使用property保存私有变量的，于是引入runtime的AssociatedObject系列方法，可以动态为对象添加成员变量，这几乎是runtime最基础的应用。</p>

<p>非常简单的，只用到两个方法，其实就是一个Setter和Getter</p>

<p><code>id objc_getAssociatedObject(id object, const void *key)</code></p>

<p><code>void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)</code></p>

<p>如果想深入探究一下，有人已经写得挺全面了，可以点击<a href="http://blog.leichunfeng.com/blog/2015/06/26/objective-c-associated-objects-implementation-principle/">这篇文章</a></p>

<p>在本例中，用法大概是这样</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#pragma mark - Getter</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="nf">loadingView</span><span class="p">{</span>
</span><span class='line'>    <span class="n">UIView</span> <span class="o">*</span><span class="n">loadingView</span> <span class="o">=</span> <span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">PresnterLoadingViewKey</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">loadingView</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">loadingView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">];</span>
</span><span class='line'>        <span class="n">objc_setAssociatedObject</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">PresnterLoadingViewKey</span><span class="p">,</span> <span class="n">loadingView</span><span class="p">,</span> <span class="n">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">loadingView</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">loadingView</span> <span class="nl">addSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">loadingImageView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">loadingView</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UIImageView</span> <span class="o">*</span><span class="p">)</span><span class="nf">loadingImageView</span><span class="p">{</span>
</span><span class='line'>    <span class="n">UIImageView</span> <span class="o">*</span><span class="n">imageView</span> <span class="o">=</span> <span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">PresnterLoadingImageViewKey</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imageView</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">imageView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImageView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame:</span>
</span><span class='line'>                         <span class="n">CGRectMake</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">)];</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">tmpArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">80</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;01-progress00%02d.jpg&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">]];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">tmpArr</span> <span class="nl">addObject:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="p">[</span><span class="n">imageView</span> <span class="nl">setAnimationImages:</span><span class="p">[</span><span class="n">NSArray</span> <span class="nl">arrayWithArray:</span><span class="n">tmpArr</span><span class="p">]];</span>
</span><span class='line'>        <span class="n">imageView</span><span class="p">.</span><span class="n">animationDuration</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">objc_setAssociatedObject</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">PresnterLoadingImageViewKey</span><span class="p">,</span> <span class="n">imageView</span><span class="p">,</span> <span class="n">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">imageView</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>把实例化放进Getter，这样实现方法可以同上保持不变</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *  加载视图</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">startLoading</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview:</span><span class="n">self</span><span class="p">.</span><span class="n">loadingView</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingImageView</span> <span class="n">startAnimating</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *  停止加载并消失</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopLoading</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingImageView</span> <span class="n">stopAnimating</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loadingView</span> <span class="n">removeFromSuperview</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后只需要在你需要用到这些页面的ViewController引入UIViewController+Presenter.h
然后展示就好</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">self</span> <span class="n">startLoading</span><span class="p">];</span> <span class="c1">//加载完成后调用 [self stopLoading];</span>
</span></code></pre></td></tr></table></div></figure>


<p>具体的代码我写了个demo放在github上，地址在<a href="https://github.com/KinoAndWorld/RuntimePracticeDemo">这里</a>。</p>

<p>另外实现了空白视图和失败重试视图的功能，跟loading页大同小异。
如此一来，这些公共页面的展示逻辑基本被封装进了category中，而且当我们需要修改展示的页面时，也只需修改文件里面的实现，然后暴露出方法，简单高效。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2016-04-05T16:09:14+08:00" data-updated="true" itemprop="datePublished">Apr 5<span>th</span>, 2016</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2016/04/05/build-a-reusable-menu-setting-item-in-ios/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2016/04/05/build-a-reusable-menu-setting-item-in-ios/" itemprop="url">打造一个直观易复用的iOS设置菜单页</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>几乎每一个App都有一个设置菜单页，而且他们几乎都长这样：</p>

<p><img src="/images/setting-page-shot.jpg"></p>

<h2>反面教材</h2>

<p>最简单最原始的做法是这样的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>  <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="s">@&quot;cell&quot;</span>
</span><span class='line'>                                                          <span class="nl">forIndexPath:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>          <span class="c1">// configure cell</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>          <span class="c1">// configure cell</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>          <span class="c1">// configure cell</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tableView</span> <span class="nl">deselectRowAtIndexPath:</span><span class="n">indexPath</span> <span class="nl">animated:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>            <span class="c1">// click cell 0</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>            <span class="c1">// click cell 1</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>            <span class="c1">// click cell 2</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样做不仅违反了DRY原则，在菜单项比较多的情况下烦不胜烦，而且一旦需要修改某个菜单项的内容，或者插入或者删除，修改起来都是非常容易出错的，换句话说，可维护性非常差。</p>

<h2>抽象、依赖转移</h2>

<p>通过观察我们可以发现，这些列表的结构非常相似，那么很自然地我们可以想到建立一个通用的模型来表示一个菜单.</p>

<figure class='code'><figcaption><span>KOSettingItem.h</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">KOSettingItem</span> : <span class="nc">NSObject</span>
</span><span class='line'>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">title</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UIImage</span> <span class="o">*</span><span class="n">imageIcon</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">assign</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UITableViewCellAccessoryType</span> <span class="n">accessoryType</span><span class="p">;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="n">handleCallback</span><span class="p">)();</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nf">itemWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span>
</span><span class='line'>                          <span class="nf">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nf">itemWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span>
</span><span class='line'>                          <span class="nf">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span>
</span><span class='line'>                         <span class="nf">block:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">handle</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">initWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span>
</span><span class='line'>               <span class="nf">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span>
</span><span class='line'>              <span class="nf">block:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="nv">handle</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  
</span><span class='line'><span class="k">@end</span>   
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>KOSettingItem.m</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="k">@implementation</span> <span class="nc">KOSettingItem</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nl">itemWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">title</span>
</span><span class='line'>                            <span class="nl">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="n">image</span><span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">itemWithTitle:</span><span class="n">title</span> <span class="nl">icon:</span><span class="n">image</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nl">itemWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">title</span>
</span><span class='line'>                            <span class="nl">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="n">image</span>
</span><span class='line'>                            <span class="nl">block:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="n">handle</span><span class="p">{</span>
</span><span class='line'>      <span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle:</span><span class="n">title</span> <span class="nl">icon:</span><span class="n">image</span> <span class="nl">block:</span><span class="n">handle</span><span class="p">];</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">item</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithTitle:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">title</span>
</span><span class='line'>                 <span class="nl">icon:</span><span class="p">(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="n">image</span>
</span><span class='line'>                <span class="nl">block:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)())</span><span class="n">handle</span><span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">imageIcon</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">handleCallback</span> <span class="o">=</span> <span class="n">handle</span><span class="p">;</span>
</span><span class='line'>          <span class="n">self</span><span class="p">.</span><span class="n">accessoryType</span> <span class="o">=</span> <span class="n">UITableViewCellAccessoryDisclosureIndicator</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">@end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>一个简单的模型就这样建好了，其中我们用block写了一个handleCallback用来处理表格的点击事件，接着我们来应用到TableView中，首先新增一个property <code>@property (strong, nonatomic) NSArray *settingItems;</code></p>

<p>然后在ViewDidLoad中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item1</span> <span class="o">=</span> <span class="p">[</span><span class="n">KOSettingItem</span> <span class="nl">itemWithTitle:</span><span class="s">@&quot;菜单1&quot;</span> <span class="nl">icon:</span><span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Carrot&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">item1</span> <span class="nl">setHandleCallback:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;点击菜单1&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item2</span> <span class="o">=</span> <span class="p">[</span><span class="n">KOSettingItem</span> <span class="nl">itemWithTitle:</span><span class="s">@&quot;菜单2&quot;</span> <span class="nl">icon:</span><span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Owl&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">item1</span> <span class="nl">setHandleCallback:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;点击菜单2&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item3</span> <span class="o">=</span> <span class="p">[</span><span class="n">KOSettingItem</span> <span class="nl">itemWithTitle:</span><span class="s">@&quot;菜单3&quot;</span> <span class="nl">icon:</span><span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Rubber-Duck&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">item1</span> <span class="nl">setHandleCallback:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;点击菜单3&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item4</span> <span class="o">=</span> <span class="p">[</span><span class="n">KOSettingItem</span> <span class="nl">itemWithTitle:</span><span class="s">@&quot;菜单4&quot;</span> <span class="nl">icon:</span><span class="p">[</span><span class="n">UIImage</span> <span class="nl">imageNamed:</span><span class="s">@&quot;Snowman&quot;</span><span class="p">]];</span>
</span><span class='line'><span class="p">[</span><span class="n">item1</span> <span class="nl">setHandleCallback:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;点击菜单4&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="n">self</span><span class="p">.</span><span class="n">settingItems</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="n">item1</span><span class="p">,</span> <span class="n">item2</span><span class="p">,</span> <span class="n">item3</span><span class="p">,</span> <span class="n">item4</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后修改一下TableView的Datasource和Delegate</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection:</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">settingItems</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">44</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier:</span><span class="s">@&quot;cell&quot;</span>
</span><span class='line'>                                                            <span class="nl">forIndexPath:</span><span class="n">indexPath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">settingItems</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">title</span><span class="p">;</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">imageView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">imageIcon</span><span class="p">;</span>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">accessoryType</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">accessoryType</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath:</span><span class="p">(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tableView</span> <span class="nl">deselectRowAtIndexPath:</span><span class="n">indexPath</span> <span class="nl">animated:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">KOSettingItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">settingItems</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">handleCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">item</span><span class="p">.</span><span class="n">handleCallback</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们发现再也不需要冗长的switch语句，如果需要增删菜单项，只需要修改settingItems里面的item顺序，并且由于点击事件绑定到KOSettingItem里面，也不需要担心事件与item不对应的情况，除非有特殊的样式需求，我们可以几乎不用再更改UITableViewDataSource与UITableViewDelegate的实现。</p>

<h2>尾声</h2>

<p>文章只是提供了一个思路，而且出于简明的目的KOSettingItem的模型非常简单，实际上你可以通过添加变量达到更多的可定制化效果，比如分割线的offset，自定义的accessoryView等等，完整的demo可以戳<a href="https://github.com/KinoAndWorld/MenuSettingViewDemo">这里</a>。</p>

<p>运行一下，最后的结果如图，虽然还是平淡无奇 ：）</p>

<p><img src="/images/setting-page-finish.png"></p>

<p>最后吐槽一下自己，真的好久没写博客了<em>(:з」∠)</em></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-06-16T14:01:47+08:00" data-updated="true" itemprop="datePublished">Jun 16<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2015/06/16/ios-archive-and-post-to-fir-script/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/06/16/ios-archive-and-post-to-fir-script/" itemprop="url">iOS测试流程简化：通过脚本导出ipa包与上传到Fir</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>前言</h3>

<p>在我们当前的开发流程中，大致分为 <strong>开发-测试-修复Bugs-测试反馈</strong> 这样的循环中，特别是在功能需求频繁修改和UI细节不断调整的节奏中，我们通常需要不停地在Xcode上build-选择profile-archive，然后等待几分钟，导出ipa的包，然后再把包上传到一个版本仓库中，这个仓库或许是自己搭建的服务器，或许是TestFlight、Fir等更专业的内测版本平台，总之通常都需要几个步骤才能全部完成。倘若一日之内需要上传3到4个包，对工作效率的影响尚且不谈，重复同样的事情本身心情就不舒畅。</p>

<h3>祭出利器</h3>

<p>要如何做到把上述的N个步骤简化成一步呢，其实很简单。拿Fir为例，Fir提供了可供调用的app上传接口（其他平台我暂时不知道，如果是自己搭建的服务器肯定可以提供上传接口），而且还有好心人把接口写成了脚本（参考资源1），非常nice。但是这样的话还是要自己导出ipa，还是有些繁琐，于是我又找了些许资料，熟悉了<code>xcodebuild</code>的用法，还顺带找到了别人写好的另一个脚本（参考资源2），剩下的事情就非常简单了，我合并了二者的脚本，做了一些代码修改，详细的代码可以戳<a href="https://gist.github.com/ec0d8072d3389a9f3b02.git">这里</a></p>

<p>这里边有些参数要修改成自己的项目，譬如</p>

<ul>
<li>workspace name</li>
<li>provisioningProfile</li>
<li>scheme name</li>
<li>还有Fir需要的AppID和UserToken</li>
</ul>


<p>配置好之后，把这个脚本放在xcworkspace同级目录，然后终端运行 <code>./archive_to_upload_fir.sh</code>
这时候你可以去喝杯咖啡奶茶美年达或者来一套广播体操，在一片宁静中完成了所有繁琐。</p>

<h3>缺点与改进</h3>

<p>当然我相信这并不是最终的解决方案，因为脚本还是存在着输出信息不够友好，如果出现编译错误还是要自己另外调试等不便，而且脚本本身还存在可以优化的地方，例如一些变量的参数化，让它变得更通用一些。</p>

<hr />

<p>参考资源：</p>

<ul>
<li><p><a href="https://gist.github.com/ggshily/8594b69a266a410d82a0">https://gist.github.com/ggshily/8594b69a266a410d82a0</a></p></li>
<li><p><a href="http://blog.csdn.net/vieri_ch/article/details/45147027">http://blog.csdn.net/vieri_ch/article/details/45147027</a></p></li>
</ul>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-03-18T14:41:02+08:00" data-updated="true" itemprop="datePublished">Mar 18<span>th</span>, 2015</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2015/03/18/ios-const-value/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2015/03/18/ios-const-value/" itemprop="url">iOS开发中一些常量数值</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>先说CGFloat</h3>

<p><em>几乎众所周知CGFloat其实是float和double的大一统，32位与64位浮点的联姻</em></p>

<p>那么具体有什么不同？先来看看  CGFloat的一些常量，</p>

<pre><code>CGFLOAT_TYPE
CGFLOAT_MAX
CGFLOAT_MIN
CGFLOAT_DEFINED
CGFLOAT_IS_DOUBLE
</code></pre>

<p>好奇心使然，看了下源码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cm">/* Definition of `CGFLOAT_TYPE&#39;, `CGFLOAT_IS_DOUBLE&#39;, `CGFLOAT_MIN&#39;, and</span>
</span><span class='line'><span class="cm">   `CGFLOAT_MAX&#39;. */</span>
</span><span class='line'><span class="cp">#if defined(__LP64__) &amp;&amp; __LP64__</span>
</span><span class='line'><span class="cp"># define CGFLOAT_TYPE double</span>
</span><span class='line'><span class="cp"># define CGFLOAT_IS_DOUBLE 1</span>
</span><span class='line'><span class="cp"># define CGFLOAT_MIN DBL_MIN</span>
</span><span class='line'><span class="cp"># define CGFLOAT_MAX DBL_MAX</span>
</span><span class='line'><span class="cp">#else</span>
</span><span class='line'><span class="cp"># define CGFLOAT_TYPE float</span>
</span><span class='line'><span class="cp"># define CGFLOAT_IS_DOUBLE 0</span>
</span><span class='line'><span class="cp"># define CGFLOAT_MIN FLT_MIN</span>
</span><span class='line'><span class="cp"># define CGFLOAT_MAX FLT_MAX</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Definition of the `CGFloat&#39; type and `CGFLOAT_DEFINED&#39;. */</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="n">CGFLOAT_TYPE</span> <span class="n">CGFloat</span><span class="p">;</span>
</span><span class='line'><span class="cp">#define CGFLOAT_DEFINED 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后很清晰地看到</p>

<pre><code>CGFLOAT_TYPE         64位下是double 否则float
CGFLOAT_MAX          64位下是double的max 否则float的max
CGFLOAT_MIN          64位下是double的min 否则float的min
CGFLOAT_DEFINED      就是1 为定义而定义，暂时不知道用来判断什么
CGFLOAT_IS_DOUBLE    64位下是1 否则0
</code></pre>

<p><em>(:з」∠)</em>我是不是很无聊</p>

<p>还有一个，当一个浮点型除以0的时候，有的语言会抛出异常，而oc会返回一个“非正常”的值+INF，我们可以用INFINITY常量判断。ex:(aFloat== INFINITY)</p>

<h3>NSInteger</h3>

<p>类似的， NSInteger也是囊括了int和long的大一统（还有NSUInteger，多个unsigned），定义跟上面的浮点型是一个模子的。
下面说说我踩过的一个坑。</p>

<p>在很久很久以前，我还是习惯用C语言的变量类型int，在5S出来以前大家相安无事，直到有一天一个bug袭击了我。</p>

<p>代码是这样的：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSArray</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'><span class="kt">int</span> <span class="n">foundIndex</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span> <span class="nl">indexOfObject:</span><span class="s">@&quot;&quot;</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">NSNotFound</span> <span class="o">==</span> <span class="n">foundIndex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;not found,handle it&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>为什么iPhone4s，5之流都没问题，到5s上就不对了呢。</p>

<p>刚准备烧柱香拜一拜的时候，我点开了NSNotFound的定义，发现它==NSIntegerMax，而NSIntegerMax==LONG_MAX。</p>

<p>64位下，foundIndex因为超过表示范围会被截断成-1，因此它!=NSNotFound。</p>

<p>类似的还有很多，我们应该多多jump到源码，即使只是头文件，也能发现关于Objective-C的一些底层细节。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-26T23:14:59+08:00" data-updated="true" itemprop="datePublished">Oct 26<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ji-lu/'>记录</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/26/jieyouzahuodian-book-review/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/26/jieyouzahuodian-book-review/" itemprop="url">关于救赎 ——《解忧杂货店》读记</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>虽然对东野圭吾这个作家早就耳熟能详，但实际上，这本书是东野的作品中我看的第一本。
好久没有看到这么有意思的小说了，这样一本温柔平和却一针见血、节奏缓慢却扣人心弦的小说。</p>

<p>故事没有惊天动地的阴谋，没有精心策划的犯罪，有的只是一段段看似微不足道的小事，一个个有着各自烦恼的人。</p>

<p>每个人在生命的某个时刻一定有自己无法抉择的时刻，一定有迷茫于方向的时刻，而在一个机缘巧合之下，一个名为浪矢的杂货店开始接受写着烦恼的信件，并且用心地回复。逐渐地，更多的人开始投递自己的烦恼，而每一章的不同主人公，他们的身世和际遇，或温暖或坎坷地娓娓道来。</p>

<p>每个人命运的走向却和这些抉择有关，类似AVG（文字冒险游戏）一样，不同的抉择，有时候甚至细小到说了一句不同的话，露出了一个不同的表情，都有可能触发人生走向不同的境地，这就是所谓蝴蝶效应。而当每个人物面临自己人生的选择的时候，总能激起我思考，如果是我，我会怎么做。怎样才能幸福？</p>

<p>小说的剧情正以“来信->回信”的方式推进着，随着时间的推进，越来越多的人的烦恼被倾听，被以谓忠告。当然，如果仅仅是这样，这部小说仅仅是一部温情的纪录片，随着剧情的展开，一幅庞大的画卷展开，虽然每一章的人物不同，但他们却有着千丝万缕的关系，再辅以杂货屋的神秘时间操纵设定这一科幻元素，他们的命运锁链环绕着杂货屋交错缠绕，这在结局体现得淋漓尽致，俨然一个因果循环，看得我背脊一凉，大感佩服。</p>

<p>在命运面前，我们都要虔诚，然后斗争，努力，这样我们才能得到救赎。</p>

<p>PS：感觉这本书温和得像是儿童读物啊，没有任何三俗内容，建议编进小学教材。</p>

<p>文字拙劣，谨此为记。
2014/10/25</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-09-17T00:08:59+08:00" data-updated="true" itemprop="datePublished">Sep 17<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/ios/'>iOS</a>


</div>
		
			<span class="comments"><a href="/blog/2014/09/17/weixinpayforios/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/09/17/weixinpayforios/" itemprop="url">微信支付的小坑</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>先说点题外话</h2>

<p>貌似很久很久没更新博客，有半年了吧，这半年忙着毕业的各种事情，忙着小或者比较大的项目，感受着初入职场的艰辛与喜悦，以及过着平淡无奇的小日子————好吧虽然这些都可以成为懒惰的理由，但是回顾一些自己这半年真的过于放松，许多学习的时间被游戏动漫日剧所占据，如果平时不用上班恐怕要变成废宅了吧╮(╯_╰)╭，so，确定一下今后的目标：<code>多写代码、多锻炼、多阅读、多写博客</code>，写博客主要为了思考，因为要在脑中整理语言，沉淀思想，一方面可以巩固记忆，另一方面也算是[热爱生活]的一种方式吧。</p>

<h2>好吧主题其实是</h2>

<p>其实有点为了写博客而写博客的意思，因为要分享的东西挺简单的，更像是吐槽……好吧其实我就是吐槽。</p>

<ul>
<li>吐槽1：微信支付为啥没有iOS的官方demo……实在想不通，服务端有，Android甚至WindowsPhone都有，微信这是对iOS平台歧视的节奏- &ndash;
幸好我大天朝人才辈出，早有人根据<code>渣成翔</code>的官方文档写了微信支付的<a href="https://github.com/gbammc/WechatPayDemo">非官方demo</a></li>
</ul>


<p>里面用了cocoapods， 需要下载的话好好看下说明。</p>

<ul>
<li>吐槽2：微信官方文档
虽然我知道，也理解 写代码的人一般比较讨厌写文档，但是毕竟你是一个支付组件，总有很多人需要仔细阅读的甚至copy文档里边的代码的，你可以写得很简单，但是不要犯一些低级错误好吗 (#‵′)。说明含糊不清我就不提了（其实上面的github主页有吐槽），实例代码都写错这就有点。。。
贴两段：</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">PayReq</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">PayReq</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
</span><span class='line'><span class="n">request</span><span class="p">.</span><span class="n">partnerId</span> <span class="o">=</span> <span class="n">_pactnerid</span><span class="p">;</span>
</span><span class='line'><span class="n">request</span><span class="p">.</span><span class="n">prepayId</span><span class="o">=</span> <span class="n">_prapayid</span><span class="p">;</span>
</span><span class='line'><span class="n">Request</span><span class="p">.</span><span class="n">package</span> <span class="o">=</span> <span class="n">_package</span><span class="p">;</span>
</span><span class='line'><span class="n">request</span><span class="p">.</span><span class="n">nonceStr</span><span class="o">=</span> <span class="n">_noncestr</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>第三行好好的request突然变成Request了……当时看到整个人都不太好</p>

<p>And</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// 构造参数列表</span>
</span><span class='line'><span class="n">NSMutableDictionary</span> <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="n">dictionary</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">params</span> <span class="nl">setObject:</span><span class="s">@&quot;1234567&quot;</span> <span class="nl">forKey:</span><span class="s">@&quot;appid&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>NSMutableDictionary params。。。原来NSMutableDictionary不是引用类型啊T.T</p>

<p>有些文档看了真的会哭。</p>

<ul>
<li>吐槽3：微信支付SDK</li>
</ul>


<p>处于安全便捷考虑，几乎所有的操作都在服务端完成，然后今天服务端给出API，也跟Android调通了。我本以为既然Android端都OK了，那iOS端应该也没多大问题……但是，我错了，我发现iOS端调用微信支付不成功，马上弹回原应用，拿到的是<code>errCode = -1</code>的错误。这些我就思密达了，然后一直在找是不是自己哪里调用不对。弄了一个多小时，未果。
然后很郁闷地吃了个饭，回去之后我跟服务端一步步联调……才发现问题出在PayReq的<code>sign</code>变量和<code>package</code>变量不对应。</p>

<p>再深入纠结原因，发现原来Android的文档或者SDK和iOS的处理是不一样的，而服务端是参考了Android的文档来做，我当场就呵呵了。
如果两端的处理方法不一样，至少也该说明一下吧。</p>

<hr />

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-20T16:10:20+08:00" data-updated="true" itemprop="datePublished">Mar 20<span>th</span>, 2014</time></div>
		<div class="tags">

</div>
		
			<span class="comments"><a href="/blog/2014/03/20/zxingobjc-addition/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/20/zxingobjc-addition/" itemprop="url">ZXingObjC-addition</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>二维码扫描库ZXingObjC功能完善</h2>

<p>对于做过二维码扫描的大概都对ZXing这个库不陌生，然而这个库由于跨平台，代码文件过于臃肿，而且各种步骤非常麻烦。。。
还有不知道什么原因，ZXing的iOS库在最新发布版本不见了。 <code>还是我找不到？</code>
总之因为种种原因，<a href="" title="https://github.com/TheLevelUp/ZXingObjC">ZXingObjC</a> 作为良好的替代方案粗线了。</p>

<p>顺带一提，支持 cocoapods => &lsquo;ZXingObjC&rsquo;, &lsquo;~> 2.2.6&rsquo;</p>

<p>好吧，现在进入主题，这个库很好用，但是我们在做二维码的时候一般会有一个需求，让二维码进入一个区域方才扫描，即是<code>扫描区域</code>
让我比较郁闷的是，这么完善的库居然貌似没有实现这个很常见的功能。</p>

<p>然后上GitHub上看了一下这个<a href="" title="https://github.com/TheLevelUp/ZXingObjC/issues/100">Issue</a> , 以为终于找到解决方案……却发现是个坑。具体怎么坑就不说了……也许是我不会用吧。</p>

<p>然后重新阅读了源码，发现了一个更简单的设置裁剪区域的方法。</p>

<p>&mdash;</p>

<h3>Let&rsquo;s go</h3>

<p>首先，进入<code>ZXCapture.h</code> ，添加一个property</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">CGRect</span> <span class="n">scanCrop</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后进入<code>ZXCapture.m</code> 的这个方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>  <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">captureOutput:</span><span class="p">(</span><span class="n">ZXCaptureOutput</span> <span class="o">*</span><span class="p">)</span><span class="n">captureOutput</span>
</span><span class='line'><span class="n">ZXQT</span><span class="p">(</span><span class="nl">didOutputVideoFrame:</span><span class="p">(</span><span class="n">CVImageBufferRef</span><span class="p">)</span><span class="n">videoFrame</span>
</span><span class='line'>     <span class="nl">withSampleBuffer:</span><span class="p">(</span><span class="n">QTSampleBuffer</span> <span class="o">*</span><span class="p">)</span><span class="n">sampleBuffer</span><span class="p">)</span>
</span><span class='line'><span class="n">ZXAV</span><span class="p">(</span><span class="nl">didOutputSampleBuffer:</span><span class="p">(</span><span class="n">CMSampleBufferRef</span><span class="p">)</span><span class="n">sampleBuffer</span><span class="p">)</span>
</span><span class='line'>       <span class="nl">fromConnection:</span><span class="p">(</span><span class="n">ZXCaptureConnection</span> <span class="o">*</span><span class="p">)</span><span class="n">connection</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>将大概570行位置的代码修改为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">CGImageRef</span> <span class="n">videoFrameImage</span> <span class="o">=</span> <span class="nb">NULL</span> <span class="p">;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">CGRectEqualToRect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">scanCrop</span><span class="p">,</span><span class="n">CGRectZero</span><span class="p">)){</span>
</span><span class='line'>      <span class="n">videoFrameImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">ZXCGImageLuminanceSource</span> <span class="nl">createImageFromBuffer:</span><span class="n">videoFrame</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">videoFrameImage</span> <span class="o">=</span> <span class="p">[</span><span class="n">ZXCGImageLuminanceSource</span> <span class="nl">createImageFromBuffer:</span><span class="n">videoFrame</span>
</span><span class='line'>                                                                   <span class="nl">left:</span><span class="n">_scanCrop</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span>
</span><span class='line'>                                                                    <span class="nl">top:</span><span class="n">_scanCrop</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span>
</span><span class='line'>                                                                  <span class="nl">width:</span><span class="n">_scanCrop</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span>
</span><span class='line'>                                                                 <span class="nl">height:</span><span class="n">_scanCrop</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>就这么简单。。。最后只要在客户端做类似这样的设置就好</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">self</span><span class="p">.</span><span class="n">capture</span><span class="p">.</span><span class="n">scanCrop</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="n">_scanImageView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
</span><span class='line'>                                   <span class="n">_scanImageView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
</span><span class='line'>                                   <span class="n">_scanImageView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
</span><span class='line'>                                   <span class="n">_scanImageView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>唯一需要注意的是，这个frame的 x 和 y 需要颠倒，具体原因应该跟capture的rotation有关。</p>

<p>暂时这么多吧- -虽然没人看~默默记录。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-19T09:49:23+08:00" data-updated="true" itemprop="datePublished">Mar 19<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/qi-ta/'>其他</a>


</div>
		
			<span class="comments"><a href="/blog/2014/03/19/first-blog-with-octopress/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/03/19/first-blog-with-octopress/" itemprop="url">博客成功迁移到Octopress</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>经过三番几次的努力- -终于成功迁移。</h2>

<p>噢，就这么多。</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-02-28T09:49:23+08:00" data-updated="true" itemprop="datePublished">Feb 28<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/mo-ji/'>墨迹</a>


</div>
		
			<span class="comments"><a href="/blog/2014/02/28/v-for-vendetta-comment/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/02/28/v-for-vendetta-comment/" itemprop="url">V for Vendetta Comment</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>每个人心里都有抗争的种子(V字仇杀队 影评)</h2>

<p>单从标题来看,这是一部关于仇恨(vendetta 仇杀,正是V字头)的故事,而整部影片,也确实在讲述一个失败的病毒实验体,或者说受害者V的复仇故事. V潇洒,凌然而深邃,永远戴着一副小丑似的玩世不恭的面具,而隐藏在背后的确是伤痕累累的心,和如同深渊一般噬骨的仇恨.</p>

<p>当他一步一步成功实施他的一揽子复仇计划,将警探玩弄于鼓掌之间,这是V的仇恨,但他不是杀人魔,枪炮与玫瑰同在.V心中最柔软的地方借着女主展现了出来,以略显残酷的方式,而现实本身也是如此残酷.</p>

<p>V最后决定和最后的敌人同归于尽,我想是他想亲手结束这一切吧,这一切罪孽,他们的和他自己的.</p>

<p>载着他的尸体和炸药一起撞向大楼,伴随着宏伟的交响乐,夜空炸开了绚烂的焰火,这一切显得隆重而激昂,带着对V的悲伤和叹为观止的爆炸画面感,思绪也随之炸开,伴着因焰火而亮如白昼的冥空.</p>

<p>亿万人们涌上街头,全部戴着V的面具.
或许是因为面具的掩饰人们毫无保留的肆意,
或许是V的面具给了人们巨大的力量和勇气,
而毫无疑问的是,V给了一个伟大的救赎.
他解救的不只是他自己,还有恐怖统治下的每一个人.
而我们每一个人,心中其实都有一个V,是对压迫的仇,对剥削的杀.</p>

<p>敌人都消失了,而其实,敌人一直都在.
只要这个世界还存在压迫,斗争便绝不停息.
只要这个世界还存在硝烟,玫瑰也愈加鲜艳.</p>

<p>V死了,却留下了什么.</p>

<p>这时候,脑海里回响着片头的那句话:
&ldquo;我们要记住思想,而不是记住人,因为人可能会失败.他可能会被捕,被杀死,被遗忘.但400年以后,思想仍可改变世界.&rdquo;</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2016 - Kino -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'kinoHasABlog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






		</div>
	</div>
</body>
</html>
